image: maven:3-jdk-8




build:
 stage: build
 script:
 - cd src
 - cp -r .m2 /root/ || true
 - find / -type d -name ".m2"
 - mvn clean install
 - cp -r /root/.m2 .
 
 cache:
  paths:
  - src/.m2

 artifacts:
   paths:
   - src/ear/target/eaas-server.ear

deploy:
 stage: deploy
 before_script:
  - apt-get update -qq && apt-get install -y rsync sshpass
 script:
  - sshpass -p $gitlab rsync -e "ssh -o StrictHostKeyChecking=no" -rltvz -O src/ear/target/eaas-server.ear gitlab@192.52.32.102:/mnt/data/citar-demo/deployments/eaas-server.ear


  